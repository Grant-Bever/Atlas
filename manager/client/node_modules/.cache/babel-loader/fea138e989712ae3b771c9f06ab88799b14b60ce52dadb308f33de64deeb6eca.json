{"ast":null,"code":"var _jsxFileName = \"/Users/christiansarmiento/Documents/GitHub/Atlas-V2/client/src/pages/ManagerNewInvoice.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport ManagerLayout from '../components/ManagerLayout';\nimport { FaPlus, FaTrashAlt } from 'react-icons/fa';\nimport '../styles/InvoiceForm.css';\n\n// Base URL for the API (Consider moving this to a config file)\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';\n\n// Function to get formatted date yyyy-mm-dd\nconst getFormattedDate = (date = new Date()) => {\n  return date.toISOString().split('T')[0];\n};\nfunction ManagerNewInvoice() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    orderId\n  } = useParams(); // orderId will be undefined when creating new\n  const isEditing = Boolean(orderId);\n\n  // State for form fields\n  const [customerName, setCustomerName] = useState('');\n  const [customerPhone, setCustomerPhone] = useState(''); // Phone is now editable\n  const [invoiceDate, setInvoiceDate] = useState(getFormattedDate());\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n\n  // State for UI control\n  const [isLoading, setIsLoading] = useState(isEditing); // Start loading immediately if editing\n  const [error, setError] = useState(null);\n  const [successMessage, setSuccessMessage] = useState(null);\n  const [invoiceNumber, setInvoiceNumber] = useState(isEditing ? orderId : 'Auto-Generated'); // For display\n\n  // --- Fetch Order Data if Editing ---\n  useEffect(() => {\n    const fetchOrderForEdit = async () => {\n      console.log(`Attempting to fetch order ${orderId} for editing...`);\n      setIsLoading(true);\n      setError(null);\n      try {\n        const response = await fetch(`${API_BASE_URL}/orders/${orderId}`);\n        if (!response.ok) {\n          if (response.status === 404) {\n            throw new Error(`Invoice with ID ${orderId} not found.`);\n          } else {\n            throw new Error(`Failed to fetch invoice ${orderId}. Status: ${response.status}`);\n          }\n        }\n        const orderData = await response.json();\n        console.log(\"Fetched order data:\", orderData);\n\n        // Populate state from fetched data\n        setCustomerName(orderData.customer ? orderData.customer.name : '');\n        setCustomerPhone(orderData.customer ? orderData.customer.phone : '');\n        setInvoiceDate(getFormattedDate(new Date(orderData.date)));\n        // Ensure items have a unique frontend ID if they don't have a DB id (though they should)\n        setItems(orderData.items.map((item, index) => ({\n          ...item,\n          id: item.id || Date.now() + index\n        })) || []);\n        // Total is calculated automatically by another useEffect based on items\n        setInvoiceNumber(orderData.id); // Set the actual invoice number\n      } catch (err) {\n        console.error(\"Error fetching order for edit:\", err);\n        setError(err.message || `Failed to load order ${orderId} for editing.`);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (isEditing && orderId) {\n      fetchOrderForEdit();\n    } else {\n      // Start with one empty row for new invoice\n      setItems([{\n        id: Date.now(),\n        quantity: '',\n        item: '',\n        weight: '',\n        price: '',\n        notes: '',\n        amount: 0\n      }]);\n      setIsLoading(false); // Ensure loading is false if not editing\n    }\n    // No dependencies needed that would cause re-fetch on input change\n  }, [orderId, isEditing]);\n\n  // --- Item Management ---\n  const addItemRow = () => {\n    const newId = Date.now() + Math.random();\n    setItems([...items, {\n      id: newId,\n      quantity: '',\n      item: '',\n      weight: '',\n      price: '',\n      notes: '',\n      amount: 0\n    }]);\n  };\n  const handleItemChange = (id, field, value) => {\n    setItems(prevItems => {\n      return prevItems.map(item => {\n        if (item.id === id) {\n          const newItem = {\n            ...item,\n            [field]: value\n          };\n          if (field === 'quantity' || field === 'price') {\n            const quantity = parseFloat(newItem.quantity) || 0;\n            const price = parseFloat(newItem.price) || 0;\n            newItem.amount = quantity * price;\n          }\n          return newItem;\n        }\n        return item;\n      });\n    });\n  };\n  const removeItemRow = id => {\n    setItems(prevItems => prevItems.filter(item => item.id !== id));\n  };\n\n  // Calculate total whenever items change\n  useEffect(() => {\n    const newTotal = items.reduce((sum, item) => {\n      const amount = parseFloat(item.amount) || 0;\n      return sum + amount;\n    }, 0);\n    setTotal(newTotal);\n  }, [items]);\n\n  // --- Customer Input Handlers ---\n  const handleCustomerNameChange = event => {\n    setCustomerName(event.target.value);\n  };\n  const handleCustomerPhoneChange = event => {\n    setCustomerPhone(event.target.value);\n  };\n\n  // --- Form Submission/Cancellation Handlers ---\n  const handleSave = async event => {\n    event.preventDefault();\n    setError(null);\n    setSuccessMessage(null);\n    setIsLoading(true);\n\n    // Basic Validation\n    if (!customerName.trim()) {\n      setError('Please enter a customer name.');\n      setIsLoading(false);\n      return;\n    }\n    // Add validation for phone number\n    if (!customerPhone.trim()) {\n      setError('Please enter a customer phone number.');\n      setIsLoading(false);\n      return;\n    }\n    if (items.length === 0) {\n      setError('Please add at least one item to the invoice.');\n      setIsLoading(false);\n      return;\n    }\n    if (items.some(item => !item.item || !item.quantity || !item.price)) {\n      setError('Please ensure all items have at least a description, quantity, and price.');\n      setIsLoading(false);\n      return;\n    }\n\n    // Prepare payload for the API - Sending name and phone\n    const itemPayload = items.map(({\n      id,\n      ...rest\n    }) => ({\n      // Include amount now\n      ...rest,\n      quantity: parseFloat(rest.quantity) || 0,\n      price: parseFloat(rest.price) || 0,\n      amount: parseFloat(rest.amount) || 0,\n      // Ensure amount is included and is a number\n      weight: rest.weight ? parseFloat(rest.weight) : null\n    }));\n    try {\n      let response;\n      let responseData;\n      if (isEditing) {\n        // --- Prepare Update Payload --- \n        const updatePayload = {\n          // For now, assume we only update fields directly on the Invoice table\n          // We are NOT updating customer or items via this PUT request yet\n          // customerName: customerName.trim(), // Decide if customer name should be updatable here\n          // customerPhone: customerPhone.trim(), // Decide if customer phone should be updatable here\n          date: invoiceDate,\n          total: total // Send updated total based on frontend calculation\n          // Potentially add other status fields if needed: checked_out, paid, completed\n          // TODO: Handle item updates (add/delete/modify) - Requires more complex logic\n          // This might involve fetching original items, diffing, and making separate API calls or a more complex backend endpoint.\n        };\n        console.log(`UPDATING Invoice ${orderId} with payload:`, updatePayload);\n        response = await fetch(`${API_BASE_URL}/orders/${orderId}`, {\n          // Use the orderId in the URL\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(updatePayload)\n        });\n        if (!response.ok) {\n          let errorMsg = `Failed to update invoice. Status: ${response.status} ${response.statusText}`;\n          try {\n            const errorBody = await response.json();\n            errorMsg = errorBody.message || errorMsg;\n          } catch (e) {}\n          throw new Error(errorMsg);\n        }\n        responseData = await response.json();\n        setSuccessMessage(`Invoice #${responseData.id} updated successfully!`);\n        setTimeout(() => navigate('/orders'), 2000); // Redirect after update\n      } else {\n        // --- Prepare Create Payload ---\n        const createPayload = {\n          customerName: customerName.trim(),\n          customerPhone: customerPhone.trim(),\n          date: invoiceDate,\n          total: total,\n          items: itemPayload,\n          // Send the processed items\n          checked_out: false,\n          paid: false,\n          completed: false\n        };\n        console.log(\"SAVING New Invoice:\", createPayload);\n        response = await fetch(`${API_BASE_URL}/orders`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(createPayload)\n        });\n        if (!response.ok) {\n          let errorMsg = `Failed to create invoice. Status: ${response.status} ${response.statusText}`;\n          try {\n            const errorBody = await response.json();\n            errorMsg = errorBody.message || errorMsg;\n          } catch (parseError) {\n            console.error(\"Could not parse error response body\");\n          }\n          throw new Error(errorMsg);\n        }\n        responseData = await response.json();\n        setSuccessMessage(`Invoice #${responseData.id} created successfully!`);\n        setInvoiceNumber(responseData.id);\n        setTimeout(() => navigate('/orders'), 2000);\n      }\n    } catch (err) {\n      console.error(\"Error saving invoice:\", err);\n      setError(err.message || 'An unexpected error occurred while saving the invoice.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleCancel = () => {\n    navigate('/orders');\n  };\n\n  // --- Render Logic --- \n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Loading invoice data...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 29\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 14\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: 'red',\n          padding: '20px'\n        },\n        children: [\"Error: \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 30\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 15\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n    pageTitle: isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice',\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSave,\n      className: \"invoice-form-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-form-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"invoice-actions\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"button button-primary\",\n            disabled: isLoading,\n            children: isLoading ? 'Saving...' : 'Save Invoice'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleCancel,\n            className: \"button button-secondary\",\n            disabled: isLoading,\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-indicator\",\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 23\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: [\"Error: \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 19\n      }, this), successMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-message\",\n        children: successMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 28\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-meta\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"customerNameInput\",\n            children: \"Customer Name*:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"customerNameInput\",\n            value: customerName,\n            onChange: handleCustomerNameChange,\n            placeholder: \"Customer Name\",\n            required: true,\n            disabled: isEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"customerPhoneInput\",\n            children: \"Phone*:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"tel\" // Changed type to tel\n            ,\n            id: \"customerPhoneInput\" // Changed ID\n            ,\n            value: customerPhone,\n            onChange: handleCustomerPhoneChange // Added onChange handler\n            ,\n            placeholder: \"Customer Phone Number\",\n            required: true // Made phone required\n            ,\n            disabled: isEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Invoice #:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 18\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"invoice-number\",\n            children: invoiceNumber\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 14\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"invoiceDate\",\n            children: \"Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            id: \"invoiceDate\",\n            value: invoiceDate,\n            onChange: e => setInvoiceDate(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-items-section scrollable\",\n        children: [/*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"data-table invoice-items-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Quantity*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Item Description*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 315,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Weight\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Unit Price*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 317,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Amount\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 318,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Notes\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 319,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                style: {\n                  width: '50px'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: items.map((item, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"any\",\n                  value: item.quantity,\n                  onChange: e => handleItemChange(item.id, 'quantity', e.target.value),\n                  placeholder: \"0\",\n                  required: true,\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 326,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  value: item.item,\n                  onChange: e => handleItemChange(item.id, 'item', e.target.value),\n                  placeholder: \"Item description\",\n                  required: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 327,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"any\",\n                  value: item.weight,\n                  onChange: e => handleItemChange(item.id, 'weight', e.target.value),\n                  placeholder: \"Optional\",\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 328,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"0.01\",\n                  value: item.price,\n                  onChange: e => handleItemChange(item.id, 'price', e.target.value),\n                  placeholder: \"0.00\",\n                  required: true,\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 329,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 329,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"amount-cell\",\n                children: [\"$\", (parseFloat(item.amount) || 0).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  value: item.notes,\n                  onChange: e => handleItemChange(item.id, 'notes', e.target.value),\n                  placeholder: \"Optional notes\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 331,\n                  columnNumber: 24\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 20\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"action-cell\",\n                children: (items.length > 1 || isEditing) && /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => removeItemRow(item.id),\n                  className: \"icon-button danger\",\n                  title: \"Remove Item\",\n                  children: /*#__PURE__*/_jsxDEV(FaTrashAlt, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 334,\n                    columnNumber: 137\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 334,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 19\n              }, this)]\n            }, item.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: addItemRow,\n          className: \"button add-item-button\",\n          disabled: isLoading,\n          children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 13\n          }, this), \" Add Item\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-total\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"TOTAL:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"$\", total.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 249,\n    columnNumber: 5\n  }, this);\n}\n_s(ManagerNewInvoice, \"XZMllQwaHkawKSYzIHK+oZxwCRQ=\", false, function () {\n  return [useNavigate, useParams];\n});\n_c = ManagerNewInvoice;\nexport default ManagerNewInvoice;\nvar _c;\n$RefreshReg$(_c, \"ManagerNewInvoice\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useParams","ManagerLayout","FaPlus","FaTrashAlt","jsxDEV","_jsxDEV","API_BASE_URL","process","env","REACT_APP_API_URL","getFormattedDate","date","Date","toISOString","split","ManagerNewInvoice","_s","navigate","orderId","isEditing","Boolean","customerName","setCustomerName","customerPhone","setCustomerPhone","invoiceDate","setInvoiceDate","items","setItems","total","setTotal","isLoading","setIsLoading","error","setError","successMessage","setSuccessMessage","invoiceNumber","setInvoiceNumber","fetchOrderForEdit","console","log","response","fetch","ok","status","Error","orderData","json","customer","name","phone","map","item","index","id","now","err","message","quantity","weight","price","notes","amount","addItemRow","newId","Math","random","handleItemChange","field","value","prevItems","newItem","parseFloat","removeItemRow","filter","newTotal","reduce","sum","handleCustomerNameChange","event","target","handleCustomerPhoneChange","handleSave","preventDefault","trim","length","some","itemPayload","rest","responseData","updatePayload","method","headers","body","JSON","stringify","errorMsg","statusText","errorBody","e","setTimeout","createPayload","checked_out","paid","completed","parseError","handleCancel","children","fileName","_jsxFileName","lineNumber","columnNumber","style","color","padding","pageTitle","onSubmit","className","type","disabled","onClick","htmlFor","onChange","placeholder","required","width","step","toFixed","title","_c","$RefreshReg$"],"sources":["/Users/christiansarmiento/Documents/GitHub/Atlas-V2/client/src/pages/ManagerNewInvoice.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport ManagerLayout from '../components/ManagerLayout';\nimport { FaPlus, FaTrashAlt } from 'react-icons/fa';\nimport '../styles/InvoiceForm.css';\n\n// Base URL for the API (Consider moving this to a config file)\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';\n\n// Function to get formatted date yyyy-mm-dd\nconst getFormattedDate = (date = new Date()) => {\n  return date.toISOString().split('T')[0];\n};\n\nfunction ManagerNewInvoice() {\n  const navigate = useNavigate();\n  const { orderId } = useParams(); // orderId will be undefined when creating new\n  const isEditing = Boolean(orderId);\n\n  // State for form fields\n  const [customerName, setCustomerName] = useState('');\n  const [customerPhone, setCustomerPhone] = useState(''); // Phone is now editable\n  const [invoiceDate, setInvoiceDate] = useState(getFormattedDate());\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n\n  // State for UI control\n  const [isLoading, setIsLoading] = useState(isEditing); // Start loading immediately if editing\n  const [error, setError] = useState(null);\n  const [successMessage, setSuccessMessage] = useState(null);\n  const [invoiceNumber, setInvoiceNumber] = useState(isEditing ? orderId : 'Auto-Generated'); // For display\n\n  // --- Fetch Order Data if Editing ---\n  useEffect(() => {\n    const fetchOrderForEdit = async () => {\n      console.log(`Attempting to fetch order ${orderId} for editing...`);\n      setIsLoading(true);\n      setError(null);\n      try {\n          const response = await fetch(`${API_BASE_URL}/orders/${orderId}`);\n          if (!response.ok) {\n             if (response.status === 404) {\n                 throw new Error(`Invoice with ID ${orderId} not found.`);\n             } else {\n                  throw new Error(`Failed to fetch invoice ${orderId}. Status: ${response.status}`);\n             }\n          }\n          const orderData = await response.json();\n          console.log(\"Fetched order data:\", orderData);\n\n          // Populate state from fetched data\n          setCustomerName(orderData.customer ? orderData.customer.name : '');\n          setCustomerPhone(orderData.customer ? orderData.customer.phone : '');\n          setInvoiceDate(getFormattedDate(new Date(orderData.date)));\n          // Ensure items have a unique frontend ID if they don't have a DB id (though they should)\n          setItems(orderData.items.map((item, index) => ({ ...item, id: item.id || Date.now() + index })) || []);\n          // Total is calculated automatically by another useEffect based on items\n          setInvoiceNumber(orderData.id); // Set the actual invoice number\n\n      } catch (err) {\n          console.error(\"Error fetching order for edit:\", err);\n          setError(err.message || `Failed to load order ${orderId} for editing.`);\n      } finally {\n          setIsLoading(false);\n      }\n    };\n\n    if (isEditing && orderId) {\n      fetchOrderForEdit();\n    } else {\n      // Start with one empty row for new invoice\n      setItems([{ id: Date.now(), quantity: '', item: '', weight: '', price: '', notes: '', amount: 0 }]);\n      setIsLoading(false); // Ensure loading is false if not editing\n    }\n    // No dependencies needed that would cause re-fetch on input change\n  }, [orderId, isEditing]);\n\n  // --- Item Management ---\n  const addItemRow = () => {\n    const newId = Date.now() + Math.random();\n    setItems([...items, { id: newId, quantity: '', item: '', weight: '', price: '', notes: '', amount: 0 }]);\n  };\n\n  const handleItemChange = (id, field, value) => {\n    setItems(prevItems => {\n      return prevItems.map(item => {\n        if (item.id === id) {\n          const newItem = { ...item, [field]: value };\n          if (field === 'quantity' || field === 'price') {\n            const quantity = parseFloat(newItem.quantity) || 0;\n            const price = parseFloat(newItem.price) || 0;\n            newItem.amount = quantity * price;\n          }\n          return newItem;\n        }\n        return item;\n      });\n    });\n  };\n\n  const removeItemRow = (id) => {\n    setItems(prevItems => prevItems.filter(item => item.id !== id));\n  };\n\n  // Calculate total whenever items change\n  useEffect(() => {\n    const newTotal = items.reduce((sum, item) => {\n        const amount = parseFloat(item.amount) || 0;\n        return sum + amount;\n    }, 0);\n    setTotal(newTotal);\n  }, [items]);\n\n   // --- Customer Input Handlers ---\n    const handleCustomerNameChange = (event) => {\n        setCustomerName(event.target.value);\n    };\n    const handleCustomerPhoneChange = (event) => {\n        setCustomerPhone(event.target.value);\n    };\n\n  // --- Form Submission/Cancellation Handlers ---\n  const handleSave = async (event) => {\n    event.preventDefault();\n    setError(null);\n    setSuccessMessage(null);\n    setIsLoading(true);\n\n    // Basic Validation\n     if (!customerName.trim()) {\n       setError('Please enter a customer name.');\n       setIsLoading(false);\n       return;\n     }\n     // Add validation for phone number\n     if (!customerPhone.trim()) {\n         setError('Please enter a customer phone number.');\n         setIsLoading(false);\n         return;\n     }\n     if (items.length === 0) {\n         setError('Please add at least one item to the invoice.');\n         setIsLoading(false);\n         return;\n     }\n     if (items.some(item => !item.item || !item.quantity || !item.price)) {\n         setError('Please ensure all items have at least a description, quantity, and price.');\n         setIsLoading(false);\n         return;\n     }\n\n    // Prepare payload for the API - Sending name and phone\n    const itemPayload = items.map(({ id, ...rest }) => ({ // Include amount now\n        ...rest,\n        quantity: parseFloat(rest.quantity) || 0,\n        price: parseFloat(rest.price) || 0,\n        amount: parseFloat(rest.amount) || 0, // Ensure amount is included and is a number\n        weight: rest.weight ? parseFloat(rest.weight) : null,\n    }));\n\n    try {\n        let response;\n        let responseData;\n        if (isEditing) {\n            // --- Prepare Update Payload --- \n            const updatePayload = {\n              // For now, assume we only update fields directly on the Invoice table\n              // We are NOT updating customer or items via this PUT request yet\n              // customerName: customerName.trim(), // Decide if customer name should be updatable here\n              // customerPhone: customerPhone.trim(), // Decide if customer phone should be updatable here\n              date: invoiceDate,\n              total: total, // Send updated total based on frontend calculation\n              // Potentially add other status fields if needed: checked_out, paid, completed\n              // TODO: Handle item updates (add/delete/modify) - Requires more complex logic\n              // This might involve fetching original items, diffing, and making separate API calls or a more complex backend endpoint.\n            };\n\n            console.log(`UPDATING Invoice ${orderId} with payload:`, updatePayload);\n            response = await fetch(`${API_BASE_URL}/orders/${orderId}`, { // Use the orderId in the URL\n                method: 'PUT',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(updatePayload),\n            });\n             if (!response.ok) {\n                let errorMsg = `Failed to update invoice. Status: ${response.status} ${response.statusText}`;\n                try { const errorBody = await response.json(); errorMsg = errorBody.message || errorMsg; } catch (e) {} \n                throw new Error(errorMsg);\n            }\n            responseData = await response.json();\n            setSuccessMessage(`Invoice #${responseData.id} updated successfully!`);\n            setTimeout(() => navigate('/orders'), 2000); // Redirect after update\n\n        } else {\n            // --- Prepare Create Payload ---\n            const createPayload = {\n              customerName: customerName.trim(),\n              customerPhone: customerPhone.trim(),\n              date: invoiceDate,\n              total: total,\n              items: itemPayload, // Send the processed items\n              checked_out: false,\n              paid: false,\n              completed: false,\n            };\n            console.log(\"SAVING New Invoice:\", createPayload);\n            response = await fetch(`${API_BASE_URL}/orders`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(createPayload),\n            });\n            if (!response.ok) {\n                let errorMsg = `Failed to create invoice. Status: ${response.status} ${response.statusText}`;\n                try {\n                    const errorBody = await response.json();\n                    errorMsg = errorBody.message || errorMsg;\n                } catch (parseError) {\n                    console.error(\"Could not parse error response body\");\n                }\n                throw new Error(errorMsg);\n            }\n            responseData = await response.json();\n            setSuccessMessage(`Invoice #${responseData.id} created successfully!`);\n            setInvoiceNumber(responseData.id);\n            setTimeout(() => navigate('/orders'), 2000);\n        }\n\n    } catch (err) {\n        console.error(\"Error saving invoice:\", err);\n        setError(err.message || 'An unexpected error occurred while saving the invoice.');\n    } finally {\n        setIsLoading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    navigate('/orders');\n  };\n\n  // --- Render Logic --- \n  if (isLoading) {\n      return <ManagerLayout><div>Loading invoice data...</div></ManagerLayout>;\n  }\n\n  if (error) {\n       return <ManagerLayout><div style={{ color: 'red', padding: '20px' }}>Error: {error}</div></ManagerLayout>;\n  }\n\n  return (\n    <ManagerLayout pageTitle={isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'}>\n      <form onSubmit={handleSave} className=\"invoice-form-container\">\n        <div className=\"invoice-form-header\">\n          <h2>{isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'}</h2>\n          <div className=\"invoice-actions\">\n            <button type=\"submit\" className=\"button button-primary\" disabled={isLoading}>\n              {isLoading ? 'Saving...' : 'Save Invoice'}\n            </button>\n            <button type=\"button\" onClick={handleCancel} className=\"button button-secondary\" disabled={isLoading}>\n              Cancel\n            </button>\n          </div>\n        </div>\n\n        {isLoading && <div className=\"loading-indicator\">Loading...</div>}\n        {error && <div className=\"error-message\">Error: {error}</div>}\n        {successMessage && <div className=\"success-message\">{successMessage}</div>}\n\n        {/* Invoice Header Fields */}\n        <div className=\"invoice-meta\">\n            <div className=\"meta-item\">\n                <label htmlFor=\"customerNameInput\">Customer Name*:</label>\n                 <input\n                     type=\"text\"\n                     id=\"customerNameInput\"\n                     value={customerName}\n                     onChange={handleCustomerNameChange}\n                     placeholder=\"Customer Name\"\n                     required\n                     disabled={isEditing}\n                 />\n            </div>\n            <div className=\"meta-item\">\n                <label htmlFor=\"customerPhoneInput\">Phone*:</label>\n                <input\n                    type=\"tel\"      // Changed type to tel\n                    id=\"customerPhoneInput\" // Changed ID\n                    value={customerPhone}\n                    onChange={handleCustomerPhoneChange} // Added onChange handler\n                    placeholder=\"Customer Phone Number\"\n                    required     // Made phone required\n                    disabled={isEditing}\n                />\n            </div>\n             <div className=\"meta-item\">\n                 <label>Invoice #:</label>\n                 <span className=\"invoice-number\">{invoiceNumber}</span>\n             </div>\n            <div className=\"meta-item\">\n                <label htmlFor=\"invoiceDate\">Date:</label>\n                <input\n                    type=\"date\"\n                    id=\"invoiceDate\"\n                    value={invoiceDate}\n                    onChange={(e) => setInvoiceDate(e.target.value)}\n                    required\n                />\n            </div>\n        </div>\n\n        {/* Invoice Items Table */}\n        <div className=\"invoice-items-section scrollable\">\n          <table className=\"data-table invoice-items-table\">\n            <thead>\n              <tr>\n                <th>Quantity*</th>\n                <th>Item Description*</th>\n                <th>Weight</th>\n                <th>Unit Price*</th>\n                <th>Amount</th>\n                <th>Notes</th>\n                <th style={{width: '50px'}}></th>\n              </tr>\n            </thead>\n            <tbody>\n              {items.map((item, index) => (\n                <tr key={item.id}>\n                  <td><input type=\"number\" step=\"any\" value={item.quantity} onChange={(e) => handleItemChange(item.id, 'quantity', e.target.value)} placeholder=\"0\" required className=\"input-narrow\" /></td>\n                  <td><input type=\"text\" value={item.item} onChange={(e) => handleItemChange(item.id, 'item', e.target.value)} placeholder=\"Item description\" required /></td>\n                  <td><input type=\"number\" step=\"any\" value={item.weight} onChange={(e) => handleItemChange(item.id, 'weight', e.target.value)} placeholder=\"Optional\" className=\"input-narrow\" /></td>\n                  <td><input type=\"number\" step=\"0.01\" value={item.price} onChange={(e) => handleItemChange(item.id, 'price', e.target.value)} placeholder=\"0.00\" required className=\"input-narrow\"/></td>\n                  <td className=\"amount-cell\">${(parseFloat(item.amount) || 0).toFixed(2)}</td>\n                   <td><input type=\"text\" value={item.notes} onChange={(e) => handleItemChange(item.id, 'notes', e.target.value)} placeholder=\"Optional notes\" /></td>\n                  <td className=\"action-cell\">\n                    {(items.length > 1 || isEditing) && (\n                        <button type=\"button\" onClick={() => removeItemRow(item.id)} className=\"icon-button danger\" title=\"Remove Item\"><FaTrashAlt /></button>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n          <button type=\"button\" onClick={addItemRow} className=\"button add-item-button\" disabled={isLoading}>\n            <FaPlus /> Add Item\n          </button>\n        </div>\n\n        {/* Invoice Total */}\n        <div className=\"invoice-total\">\n          <span>TOTAL:</span>\n          <span>${total.toFixed(2)}</span>\n        </div>\n\n      </form>\n    </ManagerLayout>\n  );\n}\n\nexport default ManagerNewInvoice; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}