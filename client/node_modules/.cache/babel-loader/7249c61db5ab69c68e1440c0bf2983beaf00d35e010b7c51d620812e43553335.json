{"ast":null,"code":"var _jsxFileName = \"/Users/christiansarmiento/Documents/GitHub/Atlas-V2/client/src/pages/ManagerNewInvoice.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport ManagerLayout from '../components/ManagerLayout';\nimport { FaPlus, FaTrashAlt } from 'react-icons/fa';\nimport '../styles/InvoiceForm.css';\n\n// Base URL for the API (Consider moving this to a config file)\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';\n\n// Function to get formatted date yyyy-mm-dd\nconst getFormattedDate = (date = new Date()) => {\n  return date.toISOString().split('T')[0];\n};\nfunction ManagerNewInvoice() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    orderId\n  } = useParams(); // orderId will be undefined when creating new\n  const isEditing = Boolean(orderId);\n\n  // State for form fields\n  const [customerName, setCustomerName] = useState('');\n  const [customerPhone, setCustomerPhone] = useState(''); // Phone is now editable\n  const [invoiceDate, setInvoiceDate] = useState(getFormattedDate());\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n\n  // State for UI control\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [successMessage, setSuccessMessage] = useState(null);\n  const [invoiceNumber, setInvoiceNumber] = useState(isEditing ? orderId : 'Auto-Generated'); // For display\n\n  // --- Fetch Order Data if Editing (Not implemented yet) ---\n  useEffect(() => {\n    if (isEditing) {\n      // TODO: Implement fetching existing order data for editing\n      console.warn(\"Edit mode not fully implemented yet. Fetching existing order data is required.\");\n      setError(\"Editing existing invoices is not yet supported.\");\n      setIsLoading(false);\n      // When implemented, fetch the order by orderId, populate customerName, customerPhone, invoiceDate, items, total\n    } else {\n      // Start with one empty row for new invoice\n      setItems([{\n        id: Date.now(),\n        quantity: '',\n        item: '',\n        weight: '',\n        price: '',\n        notes: '',\n        amount: 0\n      }]);\n    }\n  }, [orderId, isEditing]);\n\n  // --- Item Management ---\n  const addItemRow = () => {\n    const newId = Date.now() + Math.random();\n    setItems([...items, {\n      id: newId,\n      quantity: '',\n      item: '',\n      weight: '',\n      price: '',\n      notes: '',\n      amount: 0\n    }]);\n  };\n  const handleItemChange = (id, field, value) => {\n    setItems(prevItems => {\n      return prevItems.map(item => {\n        if (item.id === id) {\n          const newItem = {\n            ...item,\n            [field]: value\n          };\n          if (field === 'quantity' || field === 'price') {\n            const quantity = parseFloat(newItem.quantity) || 0;\n            const price = parseFloat(newItem.price) || 0;\n            newItem.amount = quantity * price;\n          }\n          return newItem;\n        }\n        return item;\n      });\n    });\n  };\n  const removeItemRow = id => {\n    setItems(prevItems => prevItems.filter(item => item.id !== id));\n  };\n\n  // Calculate total whenever items change\n  useEffect(() => {\n    const newTotal = items.reduce((sum, item) => {\n      const amount = parseFloat(item.amount) || 0;\n      return sum + amount;\n    }, 0);\n    setTotal(newTotal);\n  }, [items]);\n\n  // --- Customer Input Handlers ---\n  const handleCustomerNameChange = event => {\n    setCustomerName(event.target.value);\n  };\n  const handleCustomerPhoneChange = event => {\n    setCustomerPhone(event.target.value);\n  };\n\n  // --- Form Submission/Cancellation Handlers ---\n  const handleSave = async event => {\n    event.preventDefault();\n    setError(null);\n    setSuccessMessage(null);\n    setIsLoading(true);\n\n    // Basic Validation\n    if (!customerName.trim()) {\n      setError('Please enter a customer name.');\n      setIsLoading(false);\n      return;\n    }\n    // Add validation for phone number\n    if (!customerPhone.trim()) {\n      setError('Please enter a customer phone number.');\n      setIsLoading(false);\n      return;\n    }\n    if (items.length === 0) {\n      setError('Please add at least one item to the invoice.');\n      setIsLoading(false);\n      return;\n    }\n    if (items.some(item => !item.item || !item.quantity || !item.price)) {\n      setError('Please ensure all items have at least a description, quantity, and price.');\n      setIsLoading(false);\n      return;\n    }\n\n    // Prepare payload for the API - Sending name and phone\n    const invoicePayload = {\n      customerName: customerName.trim(),\n      customerPhone: customerPhone.trim(),\n      // Send phone number\n      date: invoiceDate,\n      total: total,\n      items: items.map(({\n        id,\n        ...rest\n      }) => ({\n        ...rest,\n        quantity: parseFloat(rest.quantity) || 0,\n        price: parseFloat(rest.price) || 0,\n        amount: parseFloat(rest.amount) || 0,\n        weight: rest.weight ? parseFloat(rest.weight) : null\n      })),\n      checked_out: false,\n      paid: false,\n      completed: false\n    };\n    try {\n      let response;\n      let responseData;\n      if (isEditing) {\n        // TODO: Implement Update logic\n        console.log(`UPDATING Invoice ${orderId}:`, invoicePayload);\n        setError(\"Updating invoices is not yet implemented.\");\n      } else {\n        console.log(\"SAVING New Invoice:\", invoicePayload);\n        response = await fetch(`${API_BASE_URL}/orders`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(invoicePayload)\n        });\n        if (!response.ok) {\n          let errorMsg = `Failed to create invoice. Status: ${response.status} ${response.statusText}`;\n          try {\n            const errorBody = await response.json();\n            errorMsg = errorBody.message || errorMsg;\n          } catch (parseError) {\n            console.error(\"Could not parse error response body\");\n          }\n          throw new Error(errorMsg);\n        }\n        responseData = await response.json();\n        setSuccessMessage(`Invoice #${responseData.id} created successfully!`);\n        setInvoiceNumber(responseData.id);\n        setTimeout(() => navigate('/orders'), 2000);\n      }\n    } catch (err) {\n      console.error(\"Error saving invoice:\", err);\n      setError(err.message || 'An unexpected error occurred while saving the invoice.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleCancel = () => {\n    navigate('/orders');\n  };\n\n  // --- Render Logic --- \n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Loading invoice data...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 29\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 14\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: 'red',\n          padding: '20px'\n        },\n        children: [\"Error: \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 30\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 15\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(ManagerLayout, {\n    pageTitle: isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice',\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSave,\n      className: \"invoice-form-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-form-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"invoice-actions\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"button button-primary\",\n            disabled: isLoading,\n            children: isLoading ? 'Saving...' : 'Save Invoice'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleCancel,\n            className: \"button button-secondary\",\n            disabled: isLoading,\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }, this), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-indicator\",\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 23\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: [\"Error: \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 19\n      }, this), successMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-message\",\n        children: successMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 28\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-meta\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"customerNameInput\",\n            children: \"Customer Name*:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"customerNameInput\",\n            value: customerName,\n            onChange: handleCustomerNameChange,\n            placeholder: \"Customer Name\",\n            required: true,\n            disabled: isEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"customerPhoneInput\",\n            children: \"Phone*:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"tel\" // Changed type to tel\n            ,\n            id: \"customerPhoneInput\" // Changed ID\n            ,\n            value: customerPhone,\n            onChange: handleCustomerPhoneChange // Added onChange handler\n            ,\n            placeholder: \"Customer Phone Number\",\n            required: true // Made phone required\n            ,\n            disabled: isEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Invoice #:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 18\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"invoice-number\",\n            children: invoiceNumber\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 14\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"meta-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"invoiceDate\",\n            children: \"Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            id: \"invoiceDate\",\n            value: invoiceDate,\n            onChange: e => setInvoiceDate(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-items-section scrollable\",\n        children: [/*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"data-table invoice-items-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Quantity*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Item Description*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 257,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Weight\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 258,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Unit Price*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Amount\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 260,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Notes\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                style: {\n                  width: '50px'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 262,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: items.map((item, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"any\",\n                  value: item.quantity,\n                  onChange: e => handleItemChange(item.id, 'quantity', e.target.value),\n                  placeholder: \"0\",\n                  required: true,\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 268,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 268,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  value: item.item,\n                  onChange: e => handleItemChange(item.id, 'item', e.target.value),\n                  placeholder: \"Item description\",\n                  required: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 269,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"any\",\n                  value: item.weight,\n                  onChange: e => handleItemChange(item.id, 'weight', e.target.value),\n                  placeholder: \"Optional\",\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 270,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  step: \"0.01\",\n                  value: item.price,\n                  onChange: e => handleItemChange(item.id, 'price', e.target.value),\n                  placeholder: \"0.00\",\n                  required: true,\n                  className: \"input-narrow\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 271,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"amount-cell\",\n                children: [\"$\", (parseFloat(item.amount) || 0).toFixed(2)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  value: item.notes,\n                  onChange: e => handleItemChange(item.id, 'notes', e.target.value),\n                  placeholder: \"Optional notes\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 273,\n                  columnNumber: 24\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 20\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"action-cell\",\n                children: (items.length > 1 || isEditing) && /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => removeItemRow(item.id),\n                  className: \"icon-button danger\",\n                  title: \"Remove Item\",\n                  children: /*#__PURE__*/_jsxDEV(FaTrashAlt, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 276,\n                    columnNumber: 137\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 276,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 274,\n                columnNumber: 19\n              }, this)]\n            }, item.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: addItemRow,\n          className: \"button add-item-button\",\n          disabled: isLoading,\n          children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 13\n          }, this), \" Add Item\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-total\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"TOTAL:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"$\", total.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 191,\n    columnNumber: 5\n  }, this);\n}\n_s(ManagerNewInvoice, \"qdRt+48ZEEPqLlCCtbzFhPEoOAY=\", false, function () {\n  return [useNavigate, useParams];\n});\n_c = ManagerNewInvoice;\nexport default ManagerNewInvoice;\nvar _c;\n$RefreshReg$(_c, \"ManagerNewInvoice\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useParams","ManagerLayout","FaPlus","FaTrashAlt","jsxDEV","_jsxDEV","API_BASE_URL","process","env","REACT_APP_API_URL","getFormattedDate","date","Date","toISOString","split","ManagerNewInvoice","_s","navigate","orderId","isEditing","Boolean","customerName","setCustomerName","customerPhone","setCustomerPhone","invoiceDate","setInvoiceDate","items","setItems","total","setTotal","isLoading","setIsLoading","error","setError","successMessage","setSuccessMessage","invoiceNumber","setInvoiceNumber","console","warn","id","now","quantity","item","weight","price","notes","amount","addItemRow","newId","Math","random","handleItemChange","field","value","prevItems","map","newItem","parseFloat","removeItemRow","filter","newTotal","reduce","sum","handleCustomerNameChange","event","target","handleCustomerPhoneChange","handleSave","preventDefault","trim","length","some","invoicePayload","rest","checked_out","paid","completed","response","responseData","log","fetch","method","headers","body","JSON","stringify","ok","errorMsg","status","statusText","errorBody","json","message","parseError","Error","setTimeout","err","handleCancel","children","fileName","_jsxFileName","lineNumber","columnNumber","style","color","padding","pageTitle","onSubmit","className","type","disabled","onClick","htmlFor","onChange","placeholder","required","e","width","index","step","toFixed","title","_c","$RefreshReg$"],"sources":["/Users/christiansarmiento/Documents/GitHub/Atlas-V2/client/src/pages/ManagerNewInvoice.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport ManagerLayout from '../components/ManagerLayout';\nimport { FaPlus, FaTrashAlt } from 'react-icons/fa';\nimport '../styles/InvoiceForm.css';\n\n// Base URL for the API (Consider moving this to a config file)\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';\n\n// Function to get formatted date yyyy-mm-dd\nconst getFormattedDate = (date = new Date()) => {\n  return date.toISOString().split('T')[0];\n};\n\nfunction ManagerNewInvoice() {\n  const navigate = useNavigate();\n  const { orderId } = useParams(); // orderId will be undefined when creating new\n  const isEditing = Boolean(orderId);\n\n  // State for form fields\n  const [customerName, setCustomerName] = useState('');\n  const [customerPhone, setCustomerPhone] = useState(''); // Phone is now editable\n  const [invoiceDate, setInvoiceDate] = useState(getFormattedDate());\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n\n  // State for UI control\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [successMessage, setSuccessMessage] = useState(null);\n  const [invoiceNumber, setInvoiceNumber] = useState(isEditing ? orderId : 'Auto-Generated'); // For display\n\n  // --- Fetch Order Data if Editing (Not implemented yet) ---\n  useEffect(() => {\n    if (isEditing) {\n        // TODO: Implement fetching existing order data for editing\n        console.warn(\"Edit mode not fully implemented yet. Fetching existing order data is required.\");\n        setError(\"Editing existing invoices is not yet supported.\");\n        setIsLoading(false);\n        // When implemented, fetch the order by orderId, populate customerName, customerPhone, invoiceDate, items, total\n    } else {\n        // Start with one empty row for new invoice\n        setItems([{ id: Date.now(), quantity: '', item: '', weight: '', price: '', notes: '', amount: 0 }]);\n    }\n  }, [orderId, isEditing]);\n\n  // --- Item Management ---\n  const addItemRow = () => {\n    const newId = Date.now() + Math.random();\n    setItems([...items, { id: newId, quantity: '', item: '', weight: '', price: '', notes: '', amount: 0 }]);\n  };\n\n  const handleItemChange = (id, field, value) => {\n    setItems(prevItems => {\n      return prevItems.map(item => {\n        if (item.id === id) {\n          const newItem = { ...item, [field]: value };\n          if (field === 'quantity' || field === 'price') {\n            const quantity = parseFloat(newItem.quantity) || 0;\n            const price = parseFloat(newItem.price) || 0;\n            newItem.amount = quantity * price;\n          }\n          return newItem;\n        }\n        return item;\n      });\n    });\n  };\n\n  const removeItemRow = (id) => {\n    setItems(prevItems => prevItems.filter(item => item.id !== id));\n  };\n\n  // Calculate total whenever items change\n  useEffect(() => {\n    const newTotal = items.reduce((sum, item) => {\n        const amount = parseFloat(item.amount) || 0;\n        return sum + amount;\n    }, 0);\n    setTotal(newTotal);\n  }, [items]);\n\n   // --- Customer Input Handlers ---\n    const handleCustomerNameChange = (event) => {\n        setCustomerName(event.target.value);\n    };\n    const handleCustomerPhoneChange = (event) => {\n        setCustomerPhone(event.target.value);\n    };\n\n  // --- Form Submission/Cancellation Handlers ---\n  const handleSave = async (event) => {\n    event.preventDefault();\n    setError(null);\n    setSuccessMessage(null);\n    setIsLoading(true);\n\n    // Basic Validation\n     if (!customerName.trim()) {\n       setError('Please enter a customer name.');\n       setIsLoading(false);\n       return;\n     }\n     // Add validation for phone number\n     if (!customerPhone.trim()) {\n         setError('Please enter a customer phone number.');\n         setIsLoading(false);\n         return;\n     }\n     if (items.length === 0) {\n         setError('Please add at least one item to the invoice.');\n         setIsLoading(false);\n         return;\n     }\n     if (items.some(item => !item.item || !item.quantity || !item.price)) {\n         setError('Please ensure all items have at least a description, quantity, and price.');\n         setIsLoading(false);\n         return;\n     }\n\n    // Prepare payload for the API - Sending name and phone\n    const invoicePayload = {\n      customerName: customerName.trim(),\n      customerPhone: customerPhone.trim(), // Send phone number\n      date: invoiceDate,\n      total: total,\n      items: items.map(({ id, ...rest }) => ({\n          ...rest,\n          quantity: parseFloat(rest.quantity) || 0,\n          price: parseFloat(rest.price) || 0,\n          amount: parseFloat(rest.amount) || 0,\n          weight: rest.weight ? parseFloat(rest.weight) : null,\n      })),\n      checked_out: false,\n      paid: false,\n      completed: false,\n    };\n\n    try {\n        let response;\n        let responseData;\n        if (isEditing) {\n            // TODO: Implement Update logic\n            console.log(`UPDATING Invoice ${orderId}:`, invoicePayload);\n            setError(\"Updating invoices is not yet implemented.\");\n        } else {\n            console.log(\"SAVING New Invoice:\", invoicePayload);\n            response = await fetch(`${API_BASE_URL}/orders`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(invoicePayload),\n            });\n            if (!response.ok) {\n                let errorMsg = `Failed to create invoice. Status: ${response.status} ${response.statusText}`;\n                try {\n                    const errorBody = await response.json();\n                    errorMsg = errorBody.message || errorMsg;\n                } catch (parseError) {\n                    console.error(\"Could not parse error response body\");\n                }\n                throw new Error(errorMsg);\n            }\n            responseData = await response.json();\n            setSuccessMessage(`Invoice #${responseData.id} created successfully!`);\n            setInvoiceNumber(responseData.id);\n            setTimeout(() => navigate('/orders'), 2000);\n        }\n\n    } catch (err) {\n        console.error(\"Error saving invoice:\", err);\n        setError(err.message || 'An unexpected error occurred while saving the invoice.');\n    } finally {\n        setIsLoading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    navigate('/orders');\n  };\n\n  // --- Render Logic --- \n  if (isLoading) {\n      return <ManagerLayout><div>Loading invoice data...</div></ManagerLayout>;\n  }\n\n  if (error) {\n       return <ManagerLayout><div style={{ color: 'red', padding: '20px' }}>Error: {error}</div></ManagerLayout>;\n  }\n\n  return (\n    <ManagerLayout pageTitle={isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'}>\n      <form onSubmit={handleSave} className=\"invoice-form-container\">\n        <div className=\"invoice-form-header\">\n          <h2>{isEditing ? `Edit Invoice #${invoiceNumber}` : 'New Invoice'}</h2>\n          <div className=\"invoice-actions\">\n            <button type=\"submit\" className=\"button button-primary\" disabled={isLoading}>\n              {isLoading ? 'Saving...' : 'Save Invoice'}\n            </button>\n            <button type=\"button\" onClick={handleCancel} className=\"button button-secondary\" disabled={isLoading}>\n              Cancel\n            </button>\n          </div>\n        </div>\n\n        {isLoading && <div className=\"loading-indicator\">Loading...</div>}\n        {error && <div className=\"error-message\">Error: {error}</div>}\n        {successMessage && <div className=\"success-message\">{successMessage}</div>}\n\n        {/* Invoice Header Fields */}\n        <div className=\"invoice-meta\">\n            <div className=\"meta-item\">\n                <label htmlFor=\"customerNameInput\">Customer Name*:</label>\n                 <input\n                     type=\"text\"\n                     id=\"customerNameInput\"\n                     value={customerName}\n                     onChange={handleCustomerNameChange}\n                     placeholder=\"Customer Name\"\n                     required\n                     disabled={isEditing}\n                 />\n            </div>\n            <div className=\"meta-item\">\n                <label htmlFor=\"customerPhoneInput\">Phone*:</label>\n                <input\n                    type=\"tel\"      // Changed type to tel\n                    id=\"customerPhoneInput\" // Changed ID\n                    value={customerPhone}\n                    onChange={handleCustomerPhoneChange} // Added onChange handler\n                    placeholder=\"Customer Phone Number\"\n                    required     // Made phone required\n                    disabled={isEditing}\n                />\n            </div>\n             <div className=\"meta-item\">\n                 <label>Invoice #:</label>\n                 <span className=\"invoice-number\">{invoiceNumber}</span>\n             </div>\n            <div className=\"meta-item\">\n                <label htmlFor=\"invoiceDate\">Date:</label>\n                <input\n                    type=\"date\"\n                    id=\"invoiceDate\"\n                    value={invoiceDate}\n                    onChange={(e) => setInvoiceDate(e.target.value)}\n                    required\n                />\n            </div>\n        </div>\n\n        {/* Invoice Items Table */}\n        <div className=\"invoice-items-section scrollable\">\n          <table className=\"data-table invoice-items-table\">\n            <thead>\n              <tr>\n                <th>Quantity*</th>\n                <th>Item Description*</th>\n                <th>Weight</th>\n                <th>Unit Price*</th>\n                <th>Amount</th>\n                <th>Notes</th>\n                <th style={{width: '50px'}}></th>\n              </tr>\n            </thead>\n            <tbody>\n              {items.map((item, index) => (\n                <tr key={item.id}>\n                  <td><input type=\"number\" step=\"any\" value={item.quantity} onChange={(e) => handleItemChange(item.id, 'quantity', e.target.value)} placeholder=\"0\" required className=\"input-narrow\" /></td>\n                  <td><input type=\"text\" value={item.item} onChange={(e) => handleItemChange(item.id, 'item', e.target.value)} placeholder=\"Item description\" required /></td>\n                  <td><input type=\"number\" step=\"any\" value={item.weight} onChange={(e) => handleItemChange(item.id, 'weight', e.target.value)} placeholder=\"Optional\" className=\"input-narrow\" /></td>\n                  <td><input type=\"number\" step=\"0.01\" value={item.price} onChange={(e) => handleItemChange(item.id, 'price', e.target.value)} placeholder=\"0.00\" required className=\"input-narrow\"/></td>\n                  <td className=\"amount-cell\">${(parseFloat(item.amount) || 0).toFixed(2)}</td>\n                   <td><input type=\"text\" value={item.notes} onChange={(e) => handleItemChange(item.id, 'notes', e.target.value)} placeholder=\"Optional notes\" /></td>\n                  <td className=\"action-cell\">\n                    {(items.length > 1 || isEditing) && (\n                        <button type=\"button\" onClick={() => removeItemRow(item.id)} className=\"icon-button danger\" title=\"Remove Item\"><FaTrashAlt /></button>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n          <button type=\"button\" onClick={addItemRow} className=\"button add-item-button\" disabled={isLoading}>\n            <FaPlus /> Add Item\n          </button>\n        </div>\n\n        {/* Invoice Total */}\n        <div className=\"invoice-total\">\n          <span>TOTAL:</span>\n          <span>${total.toFixed(2)}</span>\n        </div>\n\n      </form>\n    </ManagerLayout>\n  );\n}\n\nexport default ManagerNewInvoice; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}